{# Use supported_languages from context, provided by backend #}
{% set current_lang = (language or 'en')|lower %}
<!-- Language dropdown with flags -->
<div class="dropdown">
    <button class="btn btn-sm btn-outline-secondary dropdown-toggle d-flex align-items-center"
            type="button"
            id="language-dropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false">
        {% set current = (supported_languages | selectattr('code', 'equalto', current_lang) | list | first) or supported_languages[0] %}
        <img id="current-lang-flag"
             src="{{ url_for('static', filename='img/flags/' + current.flag) }}"
             class="border border-1 p-0 me-2"
             height="17"
             alt="Current language flag"
             loading="lazy" />
        <span id="current-lang-text">{{ current.name }}</span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end"
        aria-labelledby="language-dropdown"
        id="language-dropdown-menu">
        {% for lang in supported_languages %}
            <li>
                <a class="dropdown-item d-flex align-items-center lang-option {% if current_lang == lang.code %}active{% endif %}"
                   href="#"
                   data-lang="{{ lang.code }}">
                    <img src="{{ url_for('static', filename='img/flags/' + lang.flag) }}"
                         class="border border-1 p-0 me-2"
                         height="17"
                         alt="{{ lang.name }}"
                         loading="lazy" />
                    <span>{{ lang.name }}</span>
                </a>
            </li>
        {% endfor %}
    </ul>
</div>
